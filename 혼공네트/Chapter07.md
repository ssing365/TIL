# 7-1 안정성을 위한 기술

- **가용성** : 웹서비스의 안정성을 수치로 표현한 것
    - 전체 사용 시간 중에서 **정상적인 사용 시간**
        
        ![스크린샷 2025-07-04 오후 10.35.15.jpg](./images/Chapter07/1.jpgjpg)
        
        - 업타임 - 정상적인 사용 시간
        - 다운타임 - 정상적인 사용이 불가능한 시간
    - **고가용성**(**HA**. High Availability) : 가용성이 높음
        - 모든 웹서비스 업체들의 **대단히 중요한 목표**
        
        ![스크린샷 2025-07-04 오후 10.37.27.jpg](./images/Chapter07/2.jpg.jpg)
        
        - 항상, 1초도 안 쉬고 잘 돌아가야하는 서비스에서는 파이브 나인스도 치명적
    - **가용성을 높이는 법?**
        
        ⇒ 다운 타임을 낮추면 된다.
        
        - 서비스는 왜 다운될까?
            - 과도한 트래픽
            - 예기치못한 SW상의 오류
            - 하드웨어 장애
            - 보안 공격, 자연재해 등
        - 원인을 모두 원천 차단하기는 힘들다.
        - 따라서 핵심은, **문제가 발생하더라도 계속 기능할 수 있도록 설계하는 것**
            - 이를 **결함 감내**라한다.
- 이중화
    
    : 결함을 감내하여 가용성을 높이기 위한 가장 기본적인 방법으로, **예비(백업)을 마련하는 방법**
    
    - 무엇을 이중화?
        - **문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상**
        - 이를 단일 장애점, **SPOF**(Single Point Of Failure)라고 한다.
            - ex) 서버 컴퓨터, NIC, 스위치, DB, 웹서버프로그램 등
    - 이중화 구성
        1. 액티브/스탠바이
            - 한 시스템은 가동하고, 다른 시스템은 백업 용도로 두는 이중화 구성 방식
            - 장점 : 안전하다
            - 단점 : 성능상 큰 변화는 없다.
        2. 액티브/액티브
            - 두 시스템 모두 가동 상태로 두는 구성 방식
            - 장점 : 부하분산을 할수있다. 성능상 이점이 있다.
            - 단점 : 한 시스템에 문제가 생기면 다른 시스템에 부하가 급증한다.
    - 다중화
        - 시스템을 세 개 이상으로 구성
    - 이중화/다중화 사례
        - **티밍(윈도우)과 본딩(리눅스)**
            - 여러 개의 NIC를 이중화/다중화하여 마치 더 뛰어난 성능을 보유한 하나의 인터페이스처럼 보이게 하는 기술
- 로드 밸런싱
    
    (고가용성을 요구하는 호스트는 일반적으로 클라가 아닌 서버, 서버 중심으로 얘기)
    
    - 서버를 이중화/다중화해도 문제는 남아있다. 바로 트래픽을 분산해야 의미가 있다는 것
    - 한 서버에 트래픽이 몰리면
        - 높은 부하로 CPU 발열 심해짐
        - 메모리 공간 부족
        - 제한된 대역폭과 병목 현상으로 응답이 느려지거나 누락될 수 있음
    
    ---
    
    - 해결 ⇒ 로드 밸런싱(load balancing)
        - load : 부하
        - balancing : 균형 유지
        - 로드 밸런서에 의해 수행된다.
            - L4스위치(전송계층)
            - L7스위치(응용계층)
            - 로드밸런싱 기능을 제공하는 소프트웨어
                - Nginx, HAProxy, Envoy
            
            ![스크린샷 2025-07-05 오전 11.33.03.jpg](./images/Chapter07/3.jpg)
            
        
        <aside>
        
        서버의 상태를 검사하는 헬스 체크
        
        - health check
            
            ![스크린샷 2025-07-05 오전 11.35.39.jpg](./images/Chapter07/4.jpg)
            
            - 서버들의 건강 상태를 주기적으로 모니터링하고 체크
            - 주로 로드 밸런서에 의해 이루어짐
            - HTTP, ICMP 등 다양한 프로토콜 활용
        - 헬스 체크 외에 서버 간의 메시지를 주기적으로 주고받아 상태를 검사하는 **하트비트**라는 방식도 있다.
        </aside>
        
    - 로드 밸런싱 알고리즘
        
        : 로드 밸런서가 부하를 분산시키기 위해 선택하는 방법
        
        1. 라운드 로빈 알고리즘
            
            ![스크린샷 2025-07-05 오전 11.40.23.jpg](./images/Chapter07/5.jpg)
            
            - 단순히 돌아가며 부하를 전달하는 방식
        2. 최소 연결 알고리즘
            - 연결이 적은 서버부터 우선적으로 전달하는 방식
        3. 기타
            - 무작위
            - 해시(hash) 자료구조 이용
            - 응답 시간이 가장 짧은 서버 선택
        - 가중치 라운드 로빈 알고리즘, 가중치 최소 연결 알고리즘
            
            ![스크린샷 2025-07-05 오전 11.40.10.jpg](./images/Chapter07/6.jpg)
            
            - 1,2번 알고리즘은 서버마다 가중치를 부여할 수 있다.
            - 가중치가 높은 서버가 더 많이 선택되어 더 많은 부하를 받도록 하는 것
            - 서버 간 성능이 다른 경우 주로 사용된다.